{
  "attribute": "_EHR/prescriptions",
  "foreach": "$[*]",
  "filter_by": {
    "field": "status",
    "value": "active"
  },
  "templates": {
    "root": {
      "title": "{$.medication_name}",
      "subtitle": "{$.dosage} - {$.frequency}",
      "prescriber": "@prescriber_info",
      "refill_status": "@refill_warning",
      "?last_refill": "{format_date($.refills[-1].refill_date, 'MMM dd, yyyy')}",
      "?pharmacy": "{$.refills[-1].pharmacy.name}"
    },
    "prescriber_info": "Prescribed by {$.prescriber.name}, {$.prescriber.specialty}",
    "refill_warning": {
      "conditions": [
        {
          "when": "len($.refills) == 0",
          "show": "ðŸ”´ No refills - contact prescriber immediately"
        },
        {
          "when": "len($.refills) < 2",
          "show": "ðŸŸ¡ Low refills ({len($.refills)}) - call prescriber soon"
        }
      ],
      "default": "ðŸŸ¢ {len($.refills)} refills available"
    }
  }
}
